<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="stylesheet" href="styles/index.css" />

    <title>calendar</title>
  </head>
  <body>
    <div class="loader" id="loader"></div>
    <div class="main">
      <div class="class-number">
        MS 1-1
      </div>
      <div class="home-button">
        <a href="login.html">
          <img src="./pictures/home button black.png">
        </a>
      </div>



      <div class="class-number">

      </div>

      <div class="content-wrap">
        <div class="content-right">
          <table id="calendar" align="center">
            <thead>
              <tr class="btn-wrap clearfix">
                <td>
                  <label class="prev_" id="prev"> &#60; </label>
                </td>
                <td align="center" id="current-year-month" colspan="5"></td>
                <td>
                  <label class="next_" id="next"> &#62; </label>
                </td>
              </tr>
              <tr>
                <td class="sun" align="center">Sun</td>
                <td align="center">Mon</td>
                <td align="center">Tue</td>
                <td align="center">Wed</td>
                <td align="center">Thu</td>
                <td align="center">Fri</td>
                <td class="sat" align="center">Sat</td>
              </tr>
            </thead>
            <tbody id="calendar-body" class="calendar-body"></tbody>
            
          </table>
        </div>
      </div>
      <div class="content-left">
        <div class="main-wrap">
          <div id="main-day" class="main-day"></div>
          <div id="main-date" class="main-date" value=""></div>
          <div id="main-week" class="main-week"></div>
        </div>
        <div class="todo-wrap">
          <div class="todo-title">
            <p id="todo-list">
            </p>
          </div>
          <article></article>
          
      </div>
    </div>
    <button class='buttons' id='submitBtn' type="submit" onclick="fetchPage()">SUBMIT</button>
    <script src="./ms11.js?ver=73"></script>
    <script type="text/javascript">
    async function fetchPage(){
      document.getElementById("submitBtn").setAttribute("disabled", "disabled");
      startLoading();

      let a = document.getElementById("current-year-month").innerHTML.replaceAll("&nbsp;", "");
      let year = a.slice(-4);
      let month = a.slice(0, -4);
      month = distinguishMonth(month);

      var submit = "= \""+year+"-"+month+"-"+document.getElementById("main-date").value+"\"";
      var submitValue = [submit, "high_2_1", "./json"];

      console.log(JSON.stringify(submitValue));

      await fetch("../inputpage/mysql_output.php?ver=2", {
        method:"post",
        headers:{"Content-Type":"application/json; charset=UTF-8"},
        body:JSON.stringify(submitValue)
      });

      var text = await fetch("../inputpage/json?ver=2").then(res => res.text().then(res => {
        res = JSON.parse(res);

        for(var i = 0 ; i < res.length ; i++)
        {
          res[i] = JSON.parse(res[i]);
        }

        return res;
      }));

      let value = "<table border=\"1\"><th>제목</th><th>내용</th><th>과목</th><th>날짜</th><th>교시</th>";
      for(var i = 0 ; i < text.length ; i++)
      {
        value += "<tr>";
        for(var j in text[i])
        {
          if(j !== "id"){
            value += "<td>"+text[i][j]+"</td>";
          }
        }
        value += "</tr>";
      }
      value += "</table>";

      document.getElementById("todo-list").innerHTML = value;

      stopLoading();
      document.getElementById("submitBtn").removeAttribute("disabled");
    }

    function distinguishMonth(cse)
    {
      switch(cse)
      {
        case "January":return 1;
        case "February":return 2;
        case "March":return 3;
        case "April":return 4;
        case "May":return 5;
        case "June":return 6;
        case "July":return 7;
        case "August":return 8;
        case "September":return 9;
        case "October":return 10;
        case "November":return 11;
        case "December":return 12;
        default:return 0;
      }
    }

    function startLoading()
    {
      let load = document.createElement("style");
      load.setAttribute("type", "text/css");
      load.innerHTML = ".loader{ border: 16px solid #f3f3f3; border-top: 16px solid #3498db; border-radius: 50%; width: 120px; height: 120px; animation: spin 1.5s linear infinite; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); } @keyframes spin{0% {transform: translate(-50%, -50%) rotate(0deg);} 100% {transform: translate(-50%, -50%) rotate(360deg);}}";
      document.getElementById("loader").appendChild(load);
    }

    function stopLoading()
    {
      var cell = document.getElementById("loader");

      while ( cell.hasChildNodes() )
      {
           cell.removeChild( cell.firstChild );       
      }
    }
  </script>
  </body>
</html>